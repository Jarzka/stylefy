{"version":3,"sources":["rum/derived_atom.cljc"],"mappings":"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","names":["var_args","G__26962","rum.derived-atom/derived-atom","js/Error","refs","key","f","rum.derived_atom.derived_atom","opts","map__27005","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","cljs.core.get","ref","check-equals?","recalc","G__27027","cljs.core/count","vec__27031","cljs.core.nth","a","G__27035","cljs.core/deref","vec__27039","b","G__27043","G__27044","vec__27045","c","G__27050","G__27051","G__27052","cljs.core.map","sink","G__27056","cljs.core/reset!","cljs.core.atom","watch","_","new-val","cljs.core.not_EQ_","seq__27063","cljs.core/seq","chunk__27064","count__27065","i__27066","temp__5735__auto__","cljs.core/chunked-seq?","c__4550__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","cljs.core/first","cljs.core/next","cljs.core/add-watch"],"sourcesContent":["(ns ^:no-doc rum.derived-atom)\n\n(defn derived-atom\n  ([refs key f]\n   (derived-atom refs key f {}))\n  ([refs key f opts]\n   (let [{:keys [ref check-equals?]\n          :or {check-equals? true}} opts\n         recalc (case (count refs)\n                  1 (let [[a] refs] #(f @a))\n                  2 (let [[a b] refs] #(f @a @b))\n                  3 (let [[a b c] refs] #(f @a @b @c))\n                  #(apply f (map deref refs)))\n         sink   (if ref\n                  (doto ref (reset! (recalc)))\n                  (atom (recalc)))\n         watch  (if check-equals?\n                  (fn [_ _ _ _]\n                    (let [new-val (recalc)]\n                      (when (not= @sink new-val)\n                        (reset! sink new-val))))\n                  (fn [_ _ _ _]\n                    (reset! sink (recalc))))]\n     (doseq [ref refs]\n       (add-watch ref key watch))\n     sink)))\n"]}